@model Projet__E_commerce.Models.OrderManagementViewModel

@{
    Layout = null;
    ViewData["Title"] = "Détails de la commande " + Model.NumeroCommande;
}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/admin-animation.css" asp-append-version="true" />
</head>
<body class="admin-bg">
    <div class="bg-orb-3"></div>

    <div class="d-flex">
        <!-- Sidebar -->
        <aside class="bg-white border-end vh-100 sticky-top d-none d-lg-block shadow-sm" style="width: 280px; z-index: 1000;">
            <div class="p-4 border-bottom">
                <a href="/" class="d-flex align-items-center gap-2 text-decoration-none">
                     <div class="rounded-3 bg-terracotta p-2 d-flex align-items-center justify-content-center shadow-sm" style="width: 40px; height: 40px;">
                        <i class="bi bi-flower1 text-white h5 mb-0"></i>
                    </div>
                    <div>
                        <h6 class="fw-bold mb-0 text-dark">CoopMaroc</h6>
                        <p class="small text-muted mb-0" style="font-size: 10px;">ESPACE ADMIN</p>
                    </div>
                </a>
            </div>
            
            <nav class="nav flex-column p-3 gap-1">
                <a class="nav-link text-muted rounded-3 d-flex align-items-center gap-3 py-2 px-3 mb-1 hover-effect" href="@Url.Action("Dashboard", "Admin")"><i class="bi bi-speedometer2"></i> Tableau de bord</a>
                <a class="nav-link text-muted rounded-3 d-flex align-items-center gap-3 py-2 px-3 mb-1 hover-effect" href="@Url.Action("Products", "Admin")"><i class="bi bi-box-seam"></i> Produits</a>
                <a class="nav-link active rounded-3 d-flex align-items-center gap-3 py-2 px-3 mb-1 shadow-sm" href="@Url.Action("Orders", "Admin")"><i class="bi bi-cart3"></i> Commandes</a>
                <a class="nav-link text-muted rounded-3 d-flex align-items-center gap-3 py-2 px-3 mb-1 hover-effect" href="@Url.Action("Profile", "Admin")"><i class="bi bi-gear"></i> Profil</a>
                <div class="mt-auto pt-4 border-top">
                    <a class="nav-link text-danger rounded-3 d-flex align-items-center gap-3 py-2 px-3 hover-effect" href="@Url.Action("Logout", "Account")">
                        <i class="bi bi-box-arrow-right"></i> Déconnexion
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-grow-1 p-4 p-md-5 d-flex justify-content-center" style="min-height: 100vh;">
            <div class="container-fluid" style="max-width: 900px;">
                
                <!-- Navigation Header -->
                <div class="d-flex justify-content-between align-items-center mb-5 animate-fade-down">
                    <div>
                        <a href="@Url.Action("Orders", "Admin")" class="btn btn-white rounded-pill shadow-sm hover-scale text-dark fw-bold px-4">
                            <i class="bi bi-arrow-left me-2"></i>Retour
                        </a>
                    </div>
                    <h1 class="font-display fw-bold mb-0 text-dark">Commande #@Model.NumeroCommande</h1>
                </div>

                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show border-0 shadow-sm rounded-4 mb-4" role="alert">
                        <i class="bi bi-check-circle-fill me-2"></i>@TempData["SuccessMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                @if (TempData["ErrorMessage"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show border-0 shadow-sm rounded-4 mb-4" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>@TempData["ErrorMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <div class="receipt-container animate-receipt-slide">
                    <!-- Receipt Header -->
                    <div class="receipt-header">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="brand-logo mb-2">
                                    <i class="bi bi-flower1"></i> CoopMaroc
                                </div>
                                <div class="receipt-meta">
                                    <span>Date: @Model.CreatedAt.ToString("dd MMM yyyy, HH:mm")</span>
                                    <span>ID: @Model.NumeroCommande</span>
                                </div>
                            </div>
                            <div class="status-stamp @(Model.StatusLabel.ToLower())">
                                @Model.StatusLabel
                            </div>
                        </div>
                    </div>

                    <!-- Dashed Divider -->
                    <div class="dashed-line"></div>

                    <!-- Client Info Section -->
                    <div class="receipt-section">
                        <h6 class="section-title">Client</h6>
                        <div class="client-box">
                            <div class="client-avatar">
                                <span>@Model.NomClient.Substring(0,1).ToUpper()</span>
                            </div>
                            <div class="client-details">
                                <div class="client-name">@Model.NomClient @Model.PrenomClient</div>
                                <div class="client-contact">
                                    @if (!string.IsNullOrEmpty(Model.TelephoneClient))
                                    {
                                        <span><i class="bi bi-telephone-fill"></i> @Model.TelephoneClient</span>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Items Table -->
                    <div class="receipt-section">
                        <h6 class="section-title">Articles</h6>
                        <div class="receipt-table">
                            <div class="r-row header">
                                <span class="r-col-photo" style="width: 60px;">Article</span>
                                <span class="r-col-item">Description</span>
                                <span class="r-col-qty text-center">Qté</span>
                                <span class="r-col-price text-end">Prix</span>
                            </div>
                            @foreach (var item in Model.LignesCommande)
                            {
                                <div class="r-row item align-items-center">
                                    <div class="r-col-photo" style="width: 60px;">
                                        @if (!string.IsNullOrEmpty(item.Photo))
                                        {
                                            <img src="@item.Photo" alt="Produit" class="rounded" style="width: 40px; height: 40px; object-fit: cover;">
                                        }
                                        else
                                        {
                                            <div class="bg-light rounded d-flex align-items-center justify-content-center text-muted" style="width: 40px; height: 40px;">
                                                <i class="bi bi-image" style="font-size: 1.2rem;"></i>
                                            </div>
                                        }
                                    </div>
                                    <div class="r-col-item">
                                        <div class="item-name">@item.NomProduit</div>
                                        <div class="item-variant">
                                            @if(!string.IsNullOrEmpty(item.Taille)) { <span>@item.Taille</span> }
                                            @if(!string.IsNullOrEmpty(item.Couleur)) { <span class="ms-1">@item.Couleur</span> }
                                        </div>
                                    </div>
                                    <div class="r-col-qty text-center">x @item.Quantite</div>
                                    <div class="r-col-price text-end">@item.SousTotal.ToString("N2") DH</div>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Dashed Divider -->
                    <div class="dashed-line"></div>

                    <!-- Total Section -->
                    <div class="receipt-footer">
                        <div class="footer-row highlight">
                            <span>Total Coopérative:</span>
                            <span class="amount-admin">@Model.PrixTotalAdmin.ToString("N2") DH</span>
                        </div>
                    </div>

                    <!-- Delivery Info -->
                    @if (!string.IsNullOrEmpty(Model.StatutLivraison))
                    {
                        <div class="receipt-delivery">
                            <div class="delivery-icon">
                                <i class="bi bi-truck"></i>
                            </div>
                            <div class="delivery-text">
                                <div class="fw-bold">@Model.StatutLivraison</div>
                                <div class="small">@Model.ModeLivraison</div>
                                @if (Model.DateDebutEstimation.HasValue)
                                {
                                    <div class="small mt-1">Est: @Model.DateDebutEstimation.Value.ToString("dd/MM")</div>
                                }
                            </div>
                        </div>
                    }

                    <!-- Receipt Bottom Edge -->
                    <div class="receipt-edge"></div>
                </div>

            </div>

            <style>
                /* Receipt Styles */
                .receipt-container {
                    background: white;
                    width: 100%;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 40px 40px 60px 40px;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.08); /* Soft shadow */
                    position: relative;
                    border-radius: 4px; /* Slight rounding at top */
                    mask-image: radial-gradient(circle at bottom, transparent 10px, black 11px);
                    mask-size: 100% 100%;
                    mask-position: bottom;
                    mask-repeat: no-repeat;
                    /* Alternative: clip-path for serrated edge if mask support is limited, but mask is better for paper tear */
                }
                
                /* Serrated edge implementation via pseudo element */
                .receipt-edge {
                    position: absolute;
                    bottom: -15px;
                    left: 0;
                    right: 0;
                    height: 20px;
                    background: white;
                    /* Using radial gradient for circles */
                    background-image: radial-gradient(circle, transparent 50%, white 50%);
                    background-size: 20px 20px;
                    background-position: bottom center;
                    /* Inverting with mask is cleaner but complex. Let's simpler zig zag */
                    background: 
                        linear-gradient(45deg, transparent 33.333%, white 33.333%, white 66.667%, transparent 66.667%),
                        linear-gradient(-45deg, transparent 33.333%, white 33.333%, white 66.667%, transparent 66.667%);
                    background-size: 20px 40px;
                    background-position: 0 -20px; /* Offset to hide top half */
                    display: none; /* Disabling pseudo complexity, relying on main container drop shadow and look */
                }

                /* Simple zig-zag border via CSS generator logic */
                .receipt-container::after {
                    content: "";
                    position: absolute;
                    bottom: -10px;
                    left: 0;
                    height: 20px;
                    width: 100%;
                    background: 
                         linear-gradient(135deg, transparent 75%, white 76%) 0 0,
                         linear-gradient(225deg, transparent 75%, white 76%) 0 0;
                    background-size: 20px 20px;
                    background-repeat: repeat-x;
                    background-position: 0 bottom;
                    transform: rotate(180deg);
                    filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.05));
                }

                .brand-logo {
                    font-family: 'Playfair Display', serif;
                    font-size: 1.5rem;
                    color: var(--terracotta);
                    font-weight: bold;
                }

                .receipt-meta {
                    display: flex;
                    flex-direction: column;
                    font-size: 0.85rem;
                    color: #999;
                    font-family: 'Inter', sans-serif;
                }

                .status-stamp {
                    border: 3px double;
                    padding: 5px 15px;
                    font-weight: 900;
                    text-transform: uppercase;
                    border-radius: 8px;
                    transform: rotate(-10deg);
                    font-size: 1rem;
                    letter-spacing: 2px;
                    opacity: 0.8;
                }
                /* Stamp colors based on labels (rough mapping) */
                .status-stamp { color: #555; border-color: #555; }
                .status-stamp:contains("Payée"), .status-stamp:contains("Livrée") { color: #27ae60; border-color: #27ae60; } /* Requires JS for :contains css or manual classes. Using razor class */

                .status-stamp.livrée, .status-stamp.payée { color: var(--majorelle); border-color: var(--majorelle); }
                .status-stamp.expédiée { color: #f39c12; border-color: #f39c12; }
                .status-stamp.annulée { color: #e74c3c; border-color: #e74c3c; }

                .dashed-line {
                    border-bottom: 2px dashed #eee;
                    margin: 2rem 0;
                }

                .section-title {
                    text-transform: uppercase;
                    font-size: 0.75rem;
                    color: #bbb;
                    letter-spacing: 1px;
                    margin-bottom: 1rem;
                }

                .client-box {
                    display: flex;
                    align-items: center;
                    background: #fdfaf8; /* Blush ultra light */
                    padding: 1.5rem;
                    border-radius: 12px;
                }

                .client-avatar {
                    width: 50px;
                    height: 50px;
                    background: var(--terracotta);
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    font-size: 1.2rem;
                    margin-right: 1rem;
                }

                .client-name {
                    font-weight: 700;
                    color: #333;
                }
                .client-contact {
                    font-size: 0.85rem;
                    color: #777;
                }

                .receipt-table {
                    display: flex;
                    flex-direction: column;
                    gap: 1rem;
                }

                .r-row {
                    display: flex;
                    justify-content: space-between;
                    font-size: 0.95rem;
                }
                .r-row.header {
                    font-weight: 600;
                    color: #999;
                    font-size: 0.85rem;
                    margin-bottom: 0.5rem;
                }
                
                .r-col-item { flex: 2; }
                .r-col-qty { flex: 0 0 60px; }
                .r-col-price { flex: 0 0 100px; }

                .item-name {
                    color: #2c3e50;
                    font-weight: 500;
                }
                .item-variant {
                    font-size: 0.8rem;
                    color: #95a5a6;
                }

                .receipt-footer .footer-row {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.5rem;
                    font-size: 0.95rem;
                    color: #7f8c8d;
                }
                .receipt-footer .amount {
                    font-weight: 600;
                    color: #2c3e50;
                }
                .receipt-footer .highlight {
                    margin-top: 1rem;
                    font-size: 1.2rem;
                    color: var(--terracotta);
                    font-weight: 700;
                    background: #fff9f5;
                    padding: 10px;
                    border-radius: 8px;
                }

                .receipt-delivery {
                    margin-top: 2rem;
                    border: 1px solid #eee;
                    border-radius: 8px;
                    padding: 1rem;
                    display: flex;
                    gap: 1rem;
                    align-items: center;
                }
                .delivery-icon {
                    width: 40px;
                    height: 40px;
                    background: #f0f2f5;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #666;
                }

                /* Animations */
                .animate-receipt-slide {
                    animation: receiptSlide 1s cubic-bezier(0.25, 1, 0.5, 1) forwards;
                    transform-origin: top;
                }

                @@keyframes receiptSlide {
                    from { transform: translateY(-50px) scaleY(0.9); opacity: 0; }
                    to { transform: translateY(0) scaleY(1); opacity: 1; }
                }

                .animate-fade-down {
                    animation: fadeDown 0.8s ease-out;
                }
                @@keyframes fadeDown {
                    from { opacity: 0; transform: translateY(-20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            </style>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
