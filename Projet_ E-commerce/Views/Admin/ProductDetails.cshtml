@model Projet__E_commerce.Models.ProductManagementViewModel
@{
    Layout = null;
    ViewData["Title"] = "Détails produit - " + Model.NomP;
    var cover = Model.Variantes.FirstOrDefault(v => !string.IsNullOrEmpty(v.photo))?.photo ?? Model.Photo;
    var stockStatus = Model.StockTotal == 0 ? "Rupture" : (Model.StockTotal <= Model.SeuilAlerte ? "Stock faible" : "En stock");
    var stockClass = Model.StockTotal == 0 ? "bg-danger text-white" : (Model.StockTotal <= Model.SeuilAlerte ? "bg-warning-subtle text-warning" : "bg-success-subtle text-success");
    ViewData["ActivePage"] = "Products";
}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/admin-animation.css" asp-append-version="true" />
</head>
<body class="admin-bg">
    <div class="bg-orb-3"></div>

    <div class="d-flex">
        <!-- Sidebar -->
        <!-- Sidebar -->
        <partial name="_AdminSidebar" />

        <!-- Main Content -->
        <main class="flex-grow-1 p-0 position-relative overflow-hidden" style="min-height: 100vh;">
            
            <!-- Hero Background removed to match admin theme -->
            <!-- <div class="product-hero-bg" ...></div> -->
            <!-- <div class="product-hero-overlay"></div> -->

            <div class="container-fluid position-relative h-100 p-4 p-md-5 d-flex flex-column">
                
                <!-- Nav -->
                <div class="d-flex justify-content-between align-items-center mb-5 animate-fade-down z-10">
                    <a href="@Url.Action("Products", "Admin")" class="btn btn-glass-dark rounded-pill shadow-sm hover-scale text-white border-0 px-4">
                        <i class="bi bi-arrow-left me-2"></i>Retour
                    </a>
                    <div class="d-flex gap-2">
                        <a href="@Url.Action("EditProduct", "Admin", new { id = Model.IdP })" class="btn btn-majorelle rounded-pill shadow-lg hover-scale px-4 border-0">
                            <i class="bi bi-pencil-square me-2"></i>Modifier
                        </a>
                    </div>
                </div>

                <div class="row h-100 overflow-visible align-items-center">
                    
                    <!-- Left: Immersive Image -->
                    <div class="col-lg-5 mb-5 mb-lg-0 text-center animate-zoom-in">
                        <div class="hero-image-container">
                            @if (!string.IsNullOrEmpty(cover))
                            {
                                <img src="@cover" alt="@Model.NomP" class="hero-image" />
                            }
                            else
                            {
                                <div class="hero-placeholder">
                                    <i class="bi bi-image"></i>
                                </div>
                            }
                            <!-- Floating Badge -->
                            <div class="floating-badge top-right @(Model.StockTotal == 0 ? "bg-danger" : "bg-success")">
                                <i class="bi bi-box-seam me-1"></i> @stockStatus
                            </div>
                        </div>
                    </div>

                    <!-- Right: Details Scrollable Panel -->
                    <div class="col-lg-7 h-100">
                        <div class="details-panel glass-panel animate-slide-up h-100 overflow-auto custom-scrollbar">
                            
                            <h1 class="product-title font-display">@Model.NomP</h1>
                            <div class="d-flex gap-3 mb-4">
                                <span class="pill-badge type-category"><i class="bi bi-tag-fill me-1"></i> @Model.NomCategorie</span>
                                <span class="pill-badge type-status @(Model.Statut == "active" ? "active" : "inactive")">
                                    <span class="dot"></span> @(Model.Statut == "active" ? "Actif" : "Inactif")
                                </span>
                            </div>

                            <p class="product-description lead">
                                @(!string.IsNullOrEmpty(Model.Description) ? Model.Description : "Aucune description disponible pour ce produit.")
                            </p>

                            <div class="stats-grid mb-5">
                                <div class="stat-card">
                                    <div class="label">Stock Total</div>
                                    <div class="value">@Model.StockTotal</div>
                                </div>
                                <div class="stat-card">
                                    <div class="label">Seuil Alerte</div>
                                    <div class="value text-warning">@Model.SeuilAlerte</div>
                                </div>
                                <div class="stat-card highlight">
                                    <div class="label">Prix Min</div>
                                    <div class="value">@Model.PrixMin?.ToString("N2") <small>MAD</small></div>
                                </div>
                                <div class="stat-card highlight">
                                    <div class="label">Prix Max</div>
                                    <div class="value">@Model.PrixMax?.ToString("N2") <small>MAD</small></div>
                                </div>
                            </div>
                            
                            <h3 class="section-title">Variantes Disponibles (@Model.Variantes.Count)</h3>
                            
                            <div class="variants-grid">
                            @if (Model.Variantes.Any())
                            {
                                foreach (var v in Model.Variantes)
                                {
                                    <div class="variant-card">
                                        <div class="v-img">
                                             @if (!string.IsNullOrEmpty(v.photo))
                                             {
                                                 <img src="@v.photo" alt="V" />
                                             }
                                             else
                                             {
                                                 <span class="text-muted small">No Img</span>
                                             }
                                        </div>
                                        <div class="v-info">
                                            <div class="v-price">@v.prix.ToString("N2") MAD</div>
                                            <div class="v-attrs">
                                                @if(!string.IsNullOrEmpty(v.taille)) { <span class="v-pill">@v.taille</span> }
                                                @if(!string.IsNullOrEmpty(v.couleur)) { 
                                                    <span class="v-color" style="background-color: @v.couleur" title="@v.couleur"></span> 
                                                }
                                            </div>
                                            <div class="v-stock mt-2">
                                                <div class="progress" style="height: 4px;">
                                                    <div class="progress-bar @(v.quantite <= Model.SeuilAlerte ? "bg-warning" : "bg-success")" role="progressbar" style="width: @Math.Min(100, (v.quantite*10))%"></div>
                                                </div>
                                                <small class="text-muted d-block mt-1">Qté: @v.quantite</small>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="empty-variants">
                                    <i class="bi bi-box-open"></i>
                                    <p>Aucune variante configurée</p>
                                </div>
                            }
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <style>
                /* Showcase Styles */
                .product-hero-bg {
                    position: absolute;
                    top: -10%; left: -10%;
                    width: 120%; height: 120%;
                    background-size: cover;
                    background-position: center;
                    filter: blur(30px) brightness(0.9);
                    z-index: 0;
                    transform: scale(1.1);
                }
                .product-hero-overlay {
                    position: absolute;
                    top: 0; left: 0;
                    width: 100%; height: 100%;
                    background: linear-gradient(135deg, rgba(255,255,255,0.85) 0%, rgba(255,240,230,0.5) 100%); /* Semi-transparent white/blush */
                    z-index: 1;
                }

                .z-10 { z-index: 10; position: relative; }
                
                .btn-glass-dark {
                    background: rgba(0,0,0,0.6);
                    backdrop-filter: blur(10px);
                    transition: all 0.3s;
                }
                .btn-majorelle {
                    background-color: var(--majorelle);
                    color: white;
                }

                .hero-image-container {
                    position: relative;
                    z-index: 10;
                    border-radius: 30px;
                    padding: 10px;
                    background: rgba(255,255,255,0.4);
                    border: 1px solid rgba(255,255,255,0.6);
                    backdrop-filter: blur(5px);
                    box-shadow: 0 20px 50px rgba(0,0,0,0.15);
                    display: inline-block;
                    max-width: 100%;
                }

                .hero-image {
                    border-radius: 20px;
                    max-height: 500px;
                    max-width: 100%;
                    object-fit: cover;
                    border: 4px solid white;
                }
                .hero-placeholder {
                    width: 300px; height: 300px;
                    background: #eee;
                    display: flex; align-items: center; justify-content: center;
                    border-radius: 20px;
                    font-size: 3rem; color: #ccc;
                }

                .floating-badge {
                    position: absolute;
                    padding: 10px 20px;
                    color: white;
                    font-weight: bold;
                    border-radius: 50px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    text-transform: uppercase;
                    letter-spacing: 1px;
                    font-size: 0.8rem;
                }
                .floating-badge.top-right { top: -15px; right: -15px; }

                .details-panel {
                    position: relative;
                    z-index: 10;
                    background: rgba(255,255,255,0.9);
                    backdrop-filter: blur(20px);
                    border-radius: 30px;
                    padding: 3rem;
                    box-shadow: -10px 0 40px rgba(0,0,0,0.05);
                    border: 1px solid rgba(255,255,255,0.8);
                    height: 90vh; /* Fixed height for scrolling */
                    margin-top: 5vh;
                }

                .product-title {
                    font-size: 3.5rem;
                    color: #2c3e50;
                    line-height: 1.1;
                    margin-bottom: 1rem;
                    background: linear-gradient(45deg, #2c3e50, var(--majorelle));
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                }

                .pill-badge {
                    padding: 6px 16px;
                    border-radius: 50px;
                    font-size: 0.85rem;
                    font-weight: 600;
                    display: inline-flex;
                    align-items: center;
                }
                .type-category { background: #f0f2f5; color: #555; }
                .type-status { border: 1px solid #ddd; }
                .type-status.active .dot { background: #2ecc71; }
                .type-status.inactive .dot { background: #e74c3c; }
                .dot { width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }

                .stat-card {
                    background: white;
                    padding: 1.5rem;
                    border-radius: 16px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.03);
                    text-align: center;
                    transition: transform 0.2s;
                    border: 1px solid #f0f0f0;
                }
                .stat-card:hover { transform: translateY(-5px); }
                .stat-card.highlight { background: #fffbf8; border-color: var(--terracotta); }
                .stat-card .label { font-size: 0.75rem; text-transform: uppercase; color: #999; letter-spacing: 1px; margin-bottom: 0.5rem; }
                .stat-card .value { font-size: 1.5rem; font-weight: 800; color: #333; }

                .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 1rem;
                }
                @@media(min-width: 1200px) { .stats-grid { grid-template-columns: repeat(4, 1fr); } }

                .section-title {
                    font-size: 1.25rem; font-weight: bold; margin-bottom: 1.5rem;
                    border-left: 4px solid var(--terracotta);
                    padding-left: 1rem;
                }

                .variants-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                    gap: 1rem;
                }

                .variant-card {
                    background: white;
                    border-radius: 16px;
                    overflow: hidden;
                    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
                    transition: transform 0.2s;
                    cursor: pointer;
                    border: 1px solid transparent;
                }
                .variant-card:hover { transform: scale(1.03); border-color: var(--majorelle); }

                .v-img {
                    height: 120px;
                    background: #f8f9fa;
                    display: flex; align-items: center; justify-content: center;
                }
                .v-img img { width: 100%; height: 100%; object-fit: cover; }
                
                .v-info { padding: 1rem; }
                .v-price { font-weight: bold; color: var(--majorelle); }
                .v-attrs { display: flex; gap: 5px; margin-top: 5px; }
                .v-pill { font-size: 0.7rem; background: #eee; padding: 2px 6px; border-radius: 4px; }
                .v-color { width: 15px; height: 15px; border-radius: 50%; border: 1px solid #ddd; }
                
                .custom-scrollbar::-webkit-scrollbar { width: 6px; }
                .custom-scrollbar::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
                .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }

                /* Animations */
                .animate-zoom-in { animation: zoomIn 1s ease-out; }
                .animate-slide-up { animation: slideUp 0.8s ease-out; }

                @@keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
                @@keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

            </style>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
