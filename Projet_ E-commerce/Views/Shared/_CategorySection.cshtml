@model IEnumerable<Projet__E_commerce.Models.Categorie>

@{
    var defaultStyles = new[]
    {
        new { Image = "~/images/categories/alimentaire.jpg", Overlay = "category-overlay-sable" },
        new { Image = "~/images/categories/cosmetique.jpg", Overlay = "category-overlay-terracotta" },
        new { Image = "~/images/categories/huile.jpg", Overlay = "category-overlay-primary" },
        new { Image = "~/images/categories/artisanat.jpg", Overlay = "category-overlay-ciel" }
    };

    (string Image, string Overlay) GetCategoryStyle(string name)
    {
        var n = name.ToLowerInvariant();
        
        // Nutritive / Alimentaire
        if (n.Contains("nutritive") || n.Contains("miel") || n.Contains("alimentaire") || n.Contains("cuisine") || n.Contains("agricole"))
            return ("~/images/categories/alimentaire.jpg", "category-overlay-terracotta");

        // Cosmétique / Beauté
        if (n.Contains("cosmétique") || n.Contains("cosmetique") || n.Contains("soin") || n.Contains("beauté"))
            return ("~/images/categories/huile.jpg", "category-overlay-primary");
            
        // Médicale / Huile pure
        if (n.Contains("medical") || n.Contains("médical") || n.Contains("huile") || n.Contains("argan"))
            return ("~/images/categories/cosmetique.jpg", "category-overlay-sable");
            
        // Artisanat
        if (n.Contains("artisanat") || n.Contains("tapis") || n.Contains("decor"))
            return ("~/images/categories/artisanat.jpg", "category-overlay-ciel");

        return ("", ""); // Return empty to signal usage of default rotation
    }
}

<section class="py-5 bg-light">
    <div class="container">
        <!-- Header -->
        <div class="d-flex flex-column flex-md-row align-items-md-end justify-content-md-between gap-3 mb-5">
            <div>
                <span class="small fw-medium text-terracotta mb-2 d-block">Nos Spécialités</span>
                <h2 class="display-5 font-display fw-bold mb-3">
                    Trésors des Coopératives
                </h2>
                <p class="text-muted" style="max-width: 500px;">
                    Des produits authentiques issus du savoir-faire ancestral des artisans marocains
                </p>
            </div>
        </div>

        <!-- Categories Grid -->
        <!-- Marquee Rail -->
        <div class="marquee-container overflow-hidden position-relative mask-linear-fade">
            <div class="marquee-content d-flex align-items-stretch gap-4">
                @if (Model != null && Model.Any())
                {
                    // Render the list twice for seamless infinite scroll
                    for (int k = 0; k < 2; k++)
                    {
                        foreach (var category in Model)
                        {
                            var (image, overlay) = GetCategoryStyle(category.nom);
                            
                            if (string.IsNullOrEmpty(image))
                            {
                                var defaultStyle = defaultStyles[category.idC % defaultStyles.Length];
                                image = defaultStyle.Image;
                                overlay = defaultStyle.Overlay;
                            }

                            <a asp-controller="Catalog" asp-action="Index" asp-route-category="@category.idC" 
                               class="category-card flex-shrink-0" 
                               style="width: 280px;">
                                <img src="@Url.Content(image)"
                                     alt="@category.nom"
                                     class="category-image" />
                                <div class="category-overlay @overlay"></div>
                                <div class="category-content">
                                    <h3 class="category-title">@category.nom</h3>
                                    <p class="category-description">@(category.description ?? "Découvrez nos produits")</p>
                                    <p class="category-count">@category.Produits?.Count produits</p>
                                </div>
                                <div class="category-hover-icon">
                                    <i class="bi bi-arrow-right"></i>
                                </div>
                            </a>
                        }
                    }
                }
                else
                {
                    <div class="w-100 text-center py-5">
                        <p class="text-muted">Aucune catégorie disponible pour le moment.</p>
                    </div>
                }
            </div>
        </div>

        <style>
            .marquee-container {
                width: 100%;
                padding: 1rem 0;
            }
            
            /* Gradient Mask for edges */
            .mask-linear-fade {
                mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
                -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%);
            }

            .marquee-content {
                animation: scroll 40s linear infinite;
                width: max-content;
            }

            /* PAUSE ON HOVER */
            .marquee-content:hover {
                animation-play-state: paused;
            }

            @@keyframes scroll {
                0% { transform: translateX(0); }
                100% { transform: translateX(-50%); } 
                /* Moves halfway because content is duplicated, creating seamless loop */
            }
        </style>
    </div>
</section>
