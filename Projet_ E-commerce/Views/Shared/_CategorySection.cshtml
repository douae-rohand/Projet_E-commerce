@model IEnumerable<Projet__E_commerce.Models.Categorie>

@{
    var defaultStyles = new[]
    {
        new { Image = "~/images/categories/alimentaire.jpg", Overlay = "category-overlay-sable" },
        new { Image = "~/images/categories/cosmetique.jpg", Overlay = "category-overlay-terracotta" },
        new { Image = "~/images/categories/huile.jpg", Overlay = "category-overlay-primary" },
        new { Image = "~/images/categories/artisanat.jpg", Overlay = "category-overlay-ciel" }
    };

    (string Image, string Overlay) GetCategoryStyle(string name)
    {
        var n = name.ToLowerInvariant();
        
        // Nutritive / Alimentaire
        if (n.Contains("nutritive") || n.Contains("miel") || n.Contains("alimentaire") || n.Contains("cuisine"))
            return ("~/images/categories/alimentaire.jpg", "category-overlay-terracotta");

        // Cosmétique / Beauté
        if (n.Contains("cosmétique") || n.Contains("cosmetique") || n.Contains("soin") || n.Contains("beauté"))
            return ("~/images/categories/huile.jpg", "category-overlay-primary");
            
        // Médicale / Huile pure
        if (n.Contains("medical") || n.Contains("médical") || n.Contains("huile") || n.Contains("argan"))
            return ("~/images/categories/cosmetique.jpg", "category-overlay-sable");
            
        // Artisanat
        if (n.Contains("artisanat") || n.Contains("tapis") || n.Contains("decor"))
            return ("~/images/categories/artisanat.jpg", "category-overlay-ciel");

        return ("", ""); // Return empty to signal usage of default rotation
    }
}

<section class="py-5 bg-light">
    <div class="container">
        <!-- Header -->
        <div class="d-flex flex-column flex-md-row align-items-md-end justify-content-md-between gap-3 mb-5">
            <div>
                <span class="small fw-medium text-terracotta mb-2 d-block">Nos Spécialités</span>
                <h2 class="display-5 font-display fw-bold mb-3">
                    Trésors des Coopératives
                </h2>
                <p class="text-muted" style="max-width: 500px;">
                    Des produits authentiques issus du savoir-faire ancestral des artisans marocains
                </p>
            </div>
        </div>

        <!-- Categories Grid -->
        <div class="row g-3 g-md-4">
            @if (Model != null && Model.Any())
            {
                int i = 0;
                foreach (var category in Model)
                {
                    var (image, overlay) = GetCategoryStyle(category.nom);
                    
                    // Fallback to rotation if no keyword match
                    if (string.IsNullOrEmpty(image))
                    {
                        var defaultStyle = defaultStyles[i % defaultStyles.Length];
                        image = defaultStyle.Image;
                        overlay = defaultStyle.Overlay;
                    }

                    // Stagger animation delay
                    var delay = i > 0 ? $"stagger-{Math.Min(i, 3)}" : "";

                    <div class="col-6 col-lg-3">
                        <a asp-controller="Catalog" asp-action="Index" asp-route-category="@category.idC" class="category-card animate-fade-in-up @delay">
                            <img src="@Url.Content(image)"
                                 alt="@category.nom"
                                 class="category-image" />
                            <div class="category-overlay @overlay"></div>
                            <div class="category-content">
                                <h3 class="category-title">@category.nom</h3>
                                <p class="category-description">@(category.description ?? "Découvrez nos produits")</p>
                                <p class="category-count">@category.Produits?.Count produits</p>
                            </div>
                            <div class="category-hover-icon">
                                <i class="bi bi-arrow-right"></i>
                            </div>
                        </a>
                    </div>
                    i++;
                }
            }
            else
            {
                <div class="col-12 text-center">
                    <p class="text-muted">Aucune catégorie disponible pour le moment.</p>
                </div>
            }
        </div>
    </div>
</section>
